<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>100 Dias Survival - ByteQuest</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#111">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0f0f0f;
  color: #eee;
}

button {
  padding: 12px 20px;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
  background: #5f27cd;
  color: #fff;
}

#menu, #difficulty, #game {
  display: none;
  padding: 40px;
  text-align: center;
}

h1 {
  font-size: 3em;
  color: #ff4757;
}

#status {
  display: flex;
  justify-content: space-around;
  margin-bottom: 15px;
}

.status {
  background: #2f3542;
  padding: 8px 12px;
  border-radius: 6px;
}

#log {
  background: #1e272e;
  height: 200px;
  overflow-y: auto;
  padding: 10px;
  border-radius: 8px;
  text-align: left;
  margin-bottom: 15px;
}

#footer {
  position: fixed;
  bottom: 0;
  width: 100%;
  text-align: center;
  background: #000;
  color: #777;
  padding: 5px;
  font-size: 0.9em;
}
</style>
</head>

<body>

<!-- MENU -->
<div id="menu">
  <h1>100 Dias Survival</h1>
  <button id="playBtn">PLAY</button>
</div>

<!-- DIFICULDADE -->
<div id="difficulty">
  <h2>Escolha a dificuldade</h2>
  <button onclick="startGame('facil')">Fácil</button>
  <button onclick="startGame('medio')">Médio</button>
  <button onclick="startGame('dificil')">Difícil</button>
</div>

<!-- JOGO -->
<div id="game">
  <div id="status">
    <div class="status" id="energia">Energia: 100</div>
    <div class="status" id="fome">Fome: 100</div>
    <div class="status" id="sede">Sede: 100</div>
    <div class="status" id="sanidade">Sanidade: 100</div>
  </div>

  <div id="log"></div>

  <button onclick="explorar()">Explorar</button>
</div>

<div id="footer">Versão 0.0.2 (beta)</div>

<script>
/* ======================
   VARIÁVEIS DO JOGO
====================== */
let energia = 100;
let fome = 100;
let sede = 100;
let sanidade = 100;
let dia = 1;

/* ======================
   ÁUDIO (CORRIGIDO)
====================== */
let audioContext = null;
let bgOsc = null;
let bgGain = null;
let audioStarted = false;

function startBackgroundAudio() {
  if (audioStarted) return;

  audioContext = new (window.AudioContext || window.webkitAudioContext)();

  bgOsc = audioContext.createOscillator();
  bgGain = audioContext.createGain();

  bgOsc.type = "sine";
  bgOsc.frequency.value = 60;
  bgGain.gain.value = 0.02;

  bgOsc.connect(bgGain);
  bgGain.connect(audioContext.destination);
  bgOsc.start();

  audioStarted = true;
}

function playEffect(freq = 600) {
  if (!audioContext) return;

  const osc = audioContext.createOscillator();
  const gain = audioContext.createGain();

  osc.frequency.value = freq;
  osc.type = "square";
  gain.gain.value = 0.05;

  osc.connect(gain);
  gain.connect(audioContext.destination);

  osc.start();
  osc.stop(audioContext.currentTime + 0.15);
}

/* ======================
   TELAS
====================== */
const menu = document.getElementById("menu");
const difficulty = document.getElementById("difficulty");
const game = document.getElementById("game");
const log = document.getElementById("log");

menu.style.display = "block";

document.getElementById("playBtn").onclick = () => {
  startBackgroundAudio(); // ✅ áudio só após clique
  menu.style.display = "none";
  difficulty.style.display = "block";
};

/* ======================
   INICIAR JOGO
====================== */
function startGame(diff) {
  difficulty.style.display = "none";
  game.style.display = "block";

  logMsg("Você acorda em um mundo destruído.");
  logMsg("Seu objetivo: sobreviver 100 dias.");

  if (diff === "medio") {
    energia = fome = sede = sanidade = 90;
  }
  if (diff === "dificil") {
    energia = fome = sede = sanidade = 80;
  }

  updateStatus();
}

/* ======================
   JOGO
====================== */
function logMsg(text) {
  log.innerHTML += `<p>Dia ${dia}: ${text}</p>`;
  log.scrollTop = log.scrollHeight;
}

function updateStatus() {
  document.getElementById("energia").innerText = `Energia: ${energia}`;
  document.getElementById("fome").innerText = `Fome: ${fome}`;
  document.getElementById("sede").innerText = `Sede: ${sede}`;
  document.getElementById("sanidade").innerText = `Sanidade: ${sanidade}`;
}

function explorar() {
  playEffect();

  energia -= 5;
  fome -= 4;
  sede -= 6;

  const eventos = [
    "Você encontrou água limpa.",
    "Você achou restos de comida.",
    "Você ouviu sons estranhos ao longe.",
    "Nada útil foi encontrado."
  ];

  const evento = eventos[Math.floor(Math.random() * eventos.length)];
  logMsg(evento);

  if (evento.includes("água")) sede += 15;
  if (evento.includes("comida")) fome += 15;
  if (evento.includes("sons")) sanidade -= 5;

  dia++;
  updateStatus();

  if (energia <= 0 || fome <= 0 || sede <= 0 || sanidade <= 0) {
    logMsg("Você não resistiu...");
    alert("GAME OVER");
    location.reload();
  }

  if (dia > 100) {
    alert("VOCÊ SOBREVIVEU 100 DIAS!");
    location.reload();
  }
}
</script>

</body>
</html>
